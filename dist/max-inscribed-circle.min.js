(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.maxInscribedCircle = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function pointOnLine(e,t){for(var r="miles",i=point([1/0,1/0],{dist:1/0}),o=0;o<t.length-1;o++){var n=point(t[o]),s=point(t[o+1]);n.properties.dist=distance(e,n,r),s.properties.dist=distance(e,s,r);var d=bearing(n,s),a=destination(e,1e3,d+90,r),p=lineIntersects(e.geometry.coordinates[0],e.geometry.coordinates[1],a.geometry.coordinates[0],a.geometry.coordinates[1],n.geometry.coordinates[0],n.geometry.coordinates[1],s.geometry.coordinates[0],s.geometry.coordinates[1]);p||(a=destination(e,1e3,d-90,r),p=lineIntersects(e.geometry.coordinates[0],e.geometry.coordinates[1],a.geometry.coordinates[0],a.geometry.coordinates[1],n.geometry.coordinates[0],n.geometry.coordinates[1],s.geometry.coordinates[0],s.geometry.coordinates[1])),a.properties.dist=1/0;var c;if(p){var c=point(p);c.properties.dist=distance(e,c,r)}n.properties.dist<i.properties.dist&&(i=n,i.properties.index=o),s.properties.dist<i.properties.dist&&(i=s,i.properties.index=o),c&&c.properties.dist<i.properties.dist&&(i=c,i.properties.index=o)}return i}function lineIntersects(e,t,r,i,o,n,s,d){var a,p,c,g,u,y={x:null,y:null,onLine1:!1,onLine2:!1};return a=(d-n)*(r-e)-(s-o)*(i-t),0==a?null!=y.x&&null!=y.y?y:!1:(p=t-n,c=e-o,g=(s-o)*p-(d-n)*c,u=(r-e)*p-(i-t)*c,p=g/a,c=u/a,y.x=e+p*(r-e),y.y=t+p*(i-t),p>=0&&1>=p&&(y.onLine1=!0),c>=0&&1>=c&&(y.onLine2=!0),y.onLine1&&y.onLine2?[y.x,y.y]:!1)}var distance=require("turf-distance"),point=require("turf-point"),linestring=require("turf-linestring"),bearing=require("turf-bearing"),destination=require("turf-destination");module.exports=function(e,t){var r;if("Feature"===e.type)r=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");r=e.geometry.coordinates}return pointOnLine(t,r)};
},{"turf-bearing":3,"turf-destination":4,"turf-distance":5,"turf-linestring":9,"turf-point":10}],2:[function(require,module,exports){
function sites(e){for(var t,o,r,i,n=[],s=0;s<e.geometry.coordinates.length;s++)for(var a=e.geometry.coordinates[s].slice(),u=0;u<a.length-1;u++)n.push({x:a[u][0],y:a[u][1]}),n.push({x:(a[u][0]+a[u+1][0])/2,y:(a[u][1]+a[u+1][1])/2}),0==s&&0==u?(t=a[u][0],o=t,r=a[u][1],i=r):(a[u][0]<t&&(t=a[u][0]),a[u][0]>o&&(o=a[u][0]),a[u][1]<r&&(r=a[u][1]),a[u][1]>i&&(i=a[u][1]));return{sites:n,bbox:{xl:t,xr:o,yt:r,yb:i}}}function fixMultiPoly(e){"MultiPolygon"==e.geometry.type&&1==e.geometry.coordinates[0].length&&(e.geometry.type="Polygon",e.geometry.coordinates=e.geometry.coordinates[0])}var Voronoi=require("voronoi"),voronoi=new Voronoi,point=require("turf-point"),pointOnLine=require("./lib/turf-point-on-line/index.js"),within=require("turf-within");module.exports=function(e){fixMultiPoly(e);for(var t=sites(e),o=voronoi.compute(t.sites,t.bbox),r={type:"FeatureCollection",features:[]},i=0;i<o.vertices.length;i++)r.features.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[o.vertices[i].x,o.vertices[i].y]}});for(var n,s={type:"FeatureCollection",features:[e]},a=within(r,s),u={coordinates:[0,0],maxDist:0},p={type:"FeatureCollection",features:[]},y=0;y<e.geometry.coordinates.length;y++)p.features.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e.geometry.coordinates[y]}});for(var f=0;f<a.features.length;f++){for(var l=0;l<p.features.length;l++)n=0==l?pointOnLine(p.features[l],a.features[f]).properties.dist:Math.min(n,pointOnLine(p.features[l],a.features[f]).properties.dist);n>u.maxDist&&(u.coordinates=a.features[f].geometry.coordinates,u.maxDist=n)}return point(u.coordinates)};
},{"./lib/turf-point-on-line/index.js":1,"turf-point":10,"turf-within":11,"voronoi":12}],3:[function(require,module,exports){
function toRad(t){return t*Math.PI/180}function toDeg(t){return 180*t/Math.PI}module.exports=function(t,o){var a=t.geometry.coordinates,n=o.geometry.coordinates,e=toRad(a[0]),r=toRad(n[0]),h=toRad(a[1]),s=toRad(n[1]),M=Math.sin(r-e)*Math.cos(s),c=Math.cos(h)*Math.sin(s)-Math.sin(h)*Math.cos(s)*Math.cos(r-e),d=toDeg(Math.atan2(M,c));return d};
},{}],4:[function(require,module,exports){
function toRad(t){return t*Math.PI/180}function toDeg(t){return 180*t/Math.PI}var point=require("turf-point");module.exports=function(t,a,e,o){var s=t.geometry.coordinates,n=toRad(s[0]),r=toRad(s[1]),i=toRad(e),h=0;switch(o){case"miles":h=3960;break;case"kilometers":h=6373;break;case"degrees":h=57.2957795;break;case"radians":h=1}var M=Math.asin(Math.sin(r)*Math.cos(a/h)+Math.cos(r)*Math.sin(a/h)*Math.cos(i)),c=n+Math.atan2(Math.sin(i)*Math.sin(a/h)*Math.cos(r),Math.cos(a/h)-Math.sin(r)*Math.sin(M));return point([toDeg(c),toDeg(M)])};
},{"turf-point":10}],5:[function(require,module,exports){
function toRad(a){return a*Math.PI/180}var invariant=require("turf-invariant");module.exports=function(a,t,e){invariant.featureOf(a,"Point","distance"),invariant.featureOf(t,"Point","distance");var r,n=a.geometry.coordinates,o=t.geometry.coordinates,i=toRad(o[1]-n[1]),s=toRad(o[0]-n[0]),c=toRad(n[1]),d=toRad(o[1]),h=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(c)*Math.cos(d),u=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));switch(e){case"miles":r=3960;break;case"kilometers":case"kilometres":r=6373;break;case"degrees":r=57.2957795;break;case"radians":r=1;break;case void 0:r=6373;break;default:throw new Error('unknown option given to "units"')}var M=r*u;return M};
},{"turf-invariant":8}],6:[function(require,module,exports){
module.exports=function(e){return{type:"FeatureCollection",features:e}};
},{}],7:[function(require,module,exports){
function inRing(e,n){for(var r=!1,o=0,t=n.length-1;o<n.length;t=o++){var g=n[o][0],i=n[o][1],a=n[t][0],f=n[t][1],l=i>e[1]!=f>e[1]&&e[0]<(a-g)*(e[1]-i)/(f-i)+g;l&&(r=!r)}return r}module.exports=function(e,n){var r=n.geometry.coordinates,o=[e.geometry.coordinates[0],e.geometry.coordinates[1]];"Polygon"===n.geometry.type&&(r=[r]);for(var t=!1,g=0;g<r.length&&!t;){if(inRing(o,r[g][0])){for(var i=!1,a=1;a<r[g].length&&!i;)inRing(o,r[g][a])&&(i=!0),a++;i||(t=!0)}g++}return t};
},{}],8:[function(require,module,exports){
function geojsonType(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function featureOf(e,r,t){if(!t)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function collectionOf(e,r,t){if(!t)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+t+", FeatureCollection required");for(var o=0;o<e.features.length;o++){var n=e.features[o];if(!n||"Feature"!==n.type||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+n.geometry.type)}}module.exports.geojsonType=geojsonType,module.exports.collectionOf=collectionOf,module.exports.featureOf=featureOf;
},{}],9:[function(require,module,exports){
module.exports=function(e,r){if(!e)throw new Error("No coordinates passed");return{type:"Feature",geometry:{type:"LineString",coordinates:e},properties:r||{}}};
},{}],10:[function(require,module,exports){
var isArray=Array.isArray||function(r){return"[object Array]"===Object.prototype.toString.call(r)};module.exports=function(r,t){if(!isArray(r))throw new Error("Coordinates must be an array");if(r.length<2)throw new Error("Coordinates must be at least 2 numbers long");return{type:"Feature",geometry:{type:"Point",coordinates:r},properties:t||{}}};
},{}],11:[function(require,module,exports){
var inside=require("turf-inside"),featureCollection=require("turf-featurecollection");module.exports=function(e,r){for(var t=featureCollection([]),u=0;u<r.features.length;u++)for(var f=0;f<e.features.length;f++){var a=inside(e.features[f],r.features[u]);a&&t.features.push(e.features[f])}return t};
},{"turf-featurecollection":6,"turf-inside":7}],12:[function(require,module,exports){
function Voronoi(){this.vertices=null,this.edges=null,this.cells=null,this.toRecycle=null,this.beachsectionJunkyard=[],this.circleEventJunkyard=[],this.vertexJunkyard=[],this.edgeJunkyard=[],this.cellJunkyard=[]}Voronoi.prototype.reset=function(){if(this.beachline||(this.beachline=new this.RBTree),this.beachline.root)for(var e=this.beachline.getFirst(this.beachline.root);e;)this.beachsectionJunkyard.push(e),e=e.rbNext;this.beachline.root=null,this.circleEvents||(this.circleEvents=new this.RBTree),this.circleEvents.root=this.firstCircleEvent=null,this.vertices=[],this.edges=[],this.cells=[]},Voronoi.prototype.sqrt=Math.sqrt,Voronoi.prototype.abs=Math.abs,Voronoi.prototype.ε=Voronoi.ε=1e-9,Voronoi.prototype.invε=Voronoi.invε=1/Voronoi.ε,Voronoi.prototype.equalWithEpsilon=function(e,t){return this.abs(e-t)<1e-9},Voronoi.prototype.greaterThanWithEpsilon=function(e,t){return e-t>1e-9},Voronoi.prototype.greaterThanOrEqualWithEpsilon=function(e,t){return 1e-9>t-e},Voronoi.prototype.lessThanWithEpsilon=function(e,t){return t-e>1e-9},Voronoi.prototype.lessThanOrEqualWithEpsilon=function(e,t){return 1e-9>e-t},Voronoi.prototype.RBTree=function(){this.root=null},Voronoi.prototype.RBTree.prototype.rbInsertSuccessor=function(e,t){var r;if(e){if(t.rbPrevious=e,t.rbNext=e.rbNext,e.rbNext&&(e.rbNext.rbPrevious=t),e.rbNext=t,e.rbRight){for(e=e.rbRight;e.rbLeft;)e=e.rbLeft;e.rbLeft=t}else e.rbRight=t;r=e}else this.root?(e=this.getFirst(this.root),t.rbPrevious=null,t.rbNext=e,e.rbPrevious=t,e.rbLeft=t,r=e):(t.rbPrevious=t.rbNext=null,this.root=t,r=null);t.rbLeft=t.rbRight=null,t.rbParent=r,t.rbRed=!0;var i,o;for(e=t;r&&r.rbRed;)i=r.rbParent,r===i.rbLeft?(o=i.rbRight,o&&o.rbRed?(r.rbRed=o.rbRed=!1,i.rbRed=!0,e=i):(e===r.rbRight&&(this.rbRotateLeft(r),e=r,r=e.rbParent),r.rbRed=!1,i.rbRed=!0,this.rbRotateRight(i))):(o=i.rbLeft,o&&o.rbRed?(r.rbRed=o.rbRed=!1,i.rbRed=!0,e=i):(e===r.rbLeft&&(this.rbRotateRight(r),e=r,r=e.rbParent),r.rbRed=!1,i.rbRed=!0,this.rbRotateLeft(i))),r=e.rbParent;this.root.rbRed=!1},Voronoi.prototype.RBTree.prototype.rbRemoveNode=function(e){e.rbNext&&(e.rbNext.rbPrevious=e.rbPrevious),e.rbPrevious&&(e.rbPrevious.rbNext=e.rbNext),e.rbNext=e.rbPrevious=null;var t,r=e.rbParent,i=e.rbLeft,o=e.rbRight;t=i?o?this.getFirst(o):i:o,r?r.rbLeft===e?r.rbLeft=t:r.rbRight=t:this.root=t;var s;if(i&&o?(s=t.rbRed,t.rbRed=e.rbRed,t.rbLeft=i,i.rbParent=t,t!==o?(r=t.rbParent,t.rbParent=e.rbParent,e=t.rbRight,r.rbLeft=e,t.rbRight=o,o.rbParent=t):(t.rbParent=r,r=t,e=t.rbRight)):(s=e.rbRed,e=t),e&&(e.rbParent=r),!s){if(e&&e.rbRed)return void(e.rbRed=!1);var n;do{if(e===this.root)break;if(e===r.rbLeft){if(n=r.rbRight,n.rbRed&&(n.rbRed=!1,r.rbRed=!0,this.rbRotateLeft(r),n=r.rbRight),n.rbLeft&&n.rbLeft.rbRed||n.rbRight&&n.rbRight.rbRed){n.rbRight&&n.rbRight.rbRed||(n.rbLeft.rbRed=!1,n.rbRed=!0,this.rbRotateRight(n),n=r.rbRight),n.rbRed=r.rbRed,r.rbRed=n.rbRight.rbRed=!1,this.rbRotateLeft(r),e=this.root;break}}else if(n=r.rbLeft,n.rbRed&&(n.rbRed=!1,r.rbRed=!0,this.rbRotateRight(r),n=r.rbLeft),n.rbLeft&&n.rbLeft.rbRed||n.rbRight&&n.rbRight.rbRed){n.rbLeft&&n.rbLeft.rbRed||(n.rbRight.rbRed=!1,n.rbRed=!0,this.rbRotateLeft(n),n=r.rbLeft),n.rbRed=r.rbRed,r.rbRed=n.rbLeft.rbRed=!1,this.rbRotateRight(r),e=this.root;break}n.rbRed=!0,e=r,r=r.rbParent}while(!e.rbRed);e&&(e.rbRed=!1)}},Voronoi.prototype.RBTree.prototype.rbRotateLeft=function(e){var t=e,r=e.rbRight,i=t.rbParent;i?i.rbLeft===t?i.rbLeft=r:i.rbRight=r:this.root=r,r.rbParent=i,t.rbParent=r,t.rbRight=r.rbLeft,t.rbRight&&(t.rbRight.rbParent=t),r.rbLeft=t},Voronoi.prototype.RBTree.prototype.rbRotateRight=function(e){var t=e,r=e.rbLeft,i=t.rbParent;i?i.rbLeft===t?i.rbLeft=r:i.rbRight=r:this.root=r,r.rbParent=i,t.rbParent=r,t.rbLeft=r.rbRight,t.rbLeft&&(t.rbLeft.rbParent=t),r.rbRight=t},Voronoi.prototype.RBTree.prototype.getFirst=function(e){for(;e.rbLeft;)e=e.rbLeft;return e},Voronoi.prototype.RBTree.prototype.getLast=function(e){for(;e.rbRight;)e=e.rbRight;return e},Voronoi.prototype.Diagram=function(e){this.site=e},Voronoi.prototype.Cell=function(e){this.site=e,this.halfedges=[],this.closeMe=!1},Voronoi.prototype.Cell.prototype.init=function(e){return this.site=e,this.halfedges=[],this.closeMe=!1,this},Voronoi.prototype.createCell=function(e){var t=this.cellJunkyard.pop();return t?t.init(e):new this.Cell(e)},Voronoi.prototype.Cell.prototype.prepareHalfedges=function(){for(var e,t=this.halfedges,r=t.length;r--;)e=t[r].edge,e.vb&&e.va||t.splice(r,1);return t.sort(function(e,t){return t.angle-e.angle}),t.length},Voronoi.prototype.Cell.prototype.getNeighborIds=function(){for(var e,t=[],r=this.halfedges.length;r--;)e=this.halfedges[r].edge,null!==e.lSite&&e.lSite.voronoiId!=this.site.voronoiId?t.push(e.lSite.voronoiId):null!==e.rSite&&e.rSite.voronoiId!=this.site.voronoiId&&t.push(e.rSite.voronoiId);return t},Voronoi.prototype.Cell.prototype.getBbox=function(){for(var e,t,r,i=this.halfedges,o=i.length,s=1/0,n=1/0,h=-(1/0),a=-(1/0);o--;)e=i[o].getStartpoint(),t=e.x,r=e.y,s>t&&(s=t),n>r&&(n=r),t>h&&(h=t),r>a&&(a=r);return{x:s,y:n,width:h-s,height:a-n}},Voronoi.prototype.Cell.prototype.pointIntersection=function(e,t){for(var r,i,o,s,n=this.halfedges,h=n.length;h--;){if(r=n[h],i=r.getStartpoint(),o=r.getEndpoint(),s=(t-i.y)*(o.x-i.x)-(e-i.x)*(o.y-i.y),!s)return 0;if(s>0)return-1}return 1},Voronoi.prototype.Vertex=function(e,t){this.x=e,this.y=t},Voronoi.prototype.Edge=function(e,t){this.lSite=e,this.rSite=t,this.va=this.vb=null},Voronoi.prototype.Halfedge=function(e,t,r){if(this.site=t,this.edge=e,r)this.angle=Math.atan2(r.y-t.y,r.x-t.x);else{var i=e.va,o=e.vb;this.angle=e.lSite===t?Math.atan2(o.x-i.x,i.y-o.y):Math.atan2(i.x-o.x,o.y-i.y)}},Voronoi.prototype.createHalfedge=function(e,t,r){return new this.Halfedge(e,t,r)},Voronoi.prototype.Halfedge.prototype.getStartpoint=function(){return this.edge.lSite===this.site?this.edge.va:this.edge.vb},Voronoi.prototype.Halfedge.prototype.getEndpoint=function(){return this.edge.lSite===this.site?this.edge.vb:this.edge.va},Voronoi.prototype.createVertex=function(e,t){var r=this.vertexJunkyard.pop();return r?(r.x=e,r.y=t):r=new this.Vertex(e,t),this.vertices.push(r),r},Voronoi.prototype.createEdge=function(e,t,r,i){var o=this.edgeJunkyard.pop();return o?(o.lSite=e,o.rSite=t,o.va=o.vb=null):o=new this.Edge(e,t),this.edges.push(o),r&&this.setEdgeStartpoint(o,e,t,r),i&&this.setEdgeEndpoint(o,e,t,i),this.cells[e.voronoiId].halfedges.push(this.createHalfedge(o,e,t)),this.cells[t.voronoiId].halfedges.push(this.createHalfedge(o,t,e)),o},Voronoi.prototype.createBorderEdge=function(e,t,r){var i=this.edgeJunkyard.pop();return i?(i.lSite=e,i.rSite=null):i=new this.Edge(e,null),i.va=t,i.vb=r,this.edges.push(i),i},Voronoi.prototype.setEdgeStartpoint=function(e,t,r,i){e.va||e.vb?e.lSite===r?e.vb=i:e.va=i:(e.va=i,e.lSite=t,e.rSite=r)},Voronoi.prototype.setEdgeEndpoint=function(e,t,r,i){this.setEdgeStartpoint(e,r,t,i)},Voronoi.prototype.Beachsection=function(){},Voronoi.prototype.createBeachsection=function(e){var t=this.beachsectionJunkyard.pop();return t||(t=new this.Beachsection),t.site=e,t},Voronoi.prototype.leftBreakPoint=function(e,t){var r=e.site,i=r.x,o=r.y,s=o-t;if(!s)return i;var n=e.rbPrevious;if(!n)return-(1/0);r=n.site;var h=r.x,a=r.y,l=a-t;if(!l)return h;var c=h-i,b=1/s-1/l,f=c/l;return b?(-f+this.sqrt(f*f-2*b*(c*c/(-2*l)-a+l/2+o-s/2)))/b+i:(i+h)/2},Voronoi.prototype.rightBreakPoint=function(e,t){var r=e.rbNext;if(r)return this.leftBreakPoint(r,t);var i=e.site;return i.y===t?i.x:1/0},Voronoi.prototype.detachBeachsection=function(e){this.detachCircleEvent(e),this.beachline.rbRemoveNode(e),this.beachsectionJunkyard.push(e)},Voronoi.prototype.removeBeachsection=function(e){var t=e.circleEvent,r=t.x,i=t.ycenter,o=this.createVertex(r,i),s=e.rbPrevious,n=e.rbNext,h=[e],a=Math.abs;this.detachBeachsection(e);for(var l=s;l.circleEvent&&a(r-l.circleEvent.x)<1e-9&&a(i-l.circleEvent.ycenter)<1e-9;)s=l.rbPrevious,h.unshift(l),this.detachBeachsection(l),l=s;h.unshift(l),this.detachCircleEvent(l);for(var c=n;c.circleEvent&&a(r-c.circleEvent.x)<1e-9&&a(i-c.circleEvent.ycenter)<1e-9;)n=c.rbNext,h.push(c),this.detachBeachsection(c),c=n;h.push(c),this.detachCircleEvent(c);var b,f=h.length;for(b=1;f>b;b++)c=h[b],l=h[b-1],this.setEdgeStartpoint(c.edge,l.site,c.site,o);l=h[0],c=h[f-1],c.edge=this.createEdge(l.site,c.site,void 0,o),this.attachCircleEvent(l),this.attachCircleEvent(c)},Voronoi.prototype.addBeachsection=function(e){for(var t,r,i,o,s=e.x,n=e.y,h=this.beachline.root;h;)if(i=this.leftBreakPoint(h,n)-s,i>1e-9)h=h.rbLeft;else{if(o=s-this.rightBreakPoint(h,n),!(o>1e-9)){i>-1e-9?(t=h.rbPrevious,r=h):o>-1e-9?(t=h,r=h.rbNext):t=r=h;break}if(!h.rbRight){t=h;break}h=h.rbRight}var a=this.createBeachsection(e);if(this.beachline.rbInsertSuccessor(t,a),t||r){if(t===r)return this.detachCircleEvent(t),r=this.createBeachsection(t.site),this.beachline.rbInsertSuccessor(a,r),a.edge=r.edge=this.createEdge(t.site,a.site),this.attachCircleEvent(t),void this.attachCircleEvent(r);if(t&&!r)return void(a.edge=this.createEdge(t.site,a.site));if(t!==r){this.detachCircleEvent(t),this.detachCircleEvent(r);var l=t.site,c=l.x,b=l.y,f=e.x-c,u=e.y-b,d=r.site,p=d.x-c,v=d.y-b,y=2*(f*v-u*p),g=f*f+u*u,R=p*p+v*v,x=this.createVertex((v*g-u*R)/y+c,(f*R-p*g)/y+b);return this.setEdgeStartpoint(r.edge,l,d,x),a.edge=this.createEdge(l,e,void 0,x),r.edge=this.createEdge(e,d,void 0,x),this.attachCircleEvent(t),void this.attachCircleEvent(r)}}},Voronoi.prototype.CircleEvent=function(){this.arc=null,this.rbLeft=null,this.rbNext=null,this.rbParent=null,this.rbPrevious=null,this.rbRed=!1,this.rbRight=null,this.site=null,this.x=this.y=this.ycenter=0},Voronoi.prototype.attachCircleEvent=function(e){var t=e.rbPrevious,r=e.rbNext;if(t&&r){var i=t.site,o=e.site,s=r.site;if(i!==s){var n=o.x,h=o.y,a=i.x-n,l=i.y-h,c=s.x-n,b=s.y-h,f=2*(a*b-l*c);if(!(f>=-2e-12)){var u=a*a+l*l,d=c*c+b*b,p=(b*u-l*d)/f,v=(a*d-c*u)/f,y=v+h,g=this.circleEventJunkyard.pop();g||(g=new this.CircleEvent),g.arc=e,g.site=o,g.x=p+n,g.y=y+this.sqrt(p*p+v*v),g.ycenter=y,e.circleEvent=g;for(var R=null,x=this.circleEvents.root;x;)if(g.y<x.y||g.y===x.y&&g.x<=x.x){if(!x.rbLeft){R=x.rbPrevious;break}x=x.rbLeft}else{if(!x.rbRight){R=x;break}x=x.rbRight}this.circleEvents.rbInsertSuccessor(R,g),R||(this.firstCircleEvent=g)}}}},Voronoi.prototype.detachCircleEvent=function(e){var t=e.circleEvent;t&&(t.rbPrevious||(this.firstCircleEvent=t.rbNext),this.circleEvents.rbRemoveNode(t),this.circleEventJunkyard.push(t),e.circleEvent=null)},Voronoi.prototype.connectEdge=function(e,t){var r=e.vb;if(r)return!0;var i,o,s=e.va,n=t.xl,h=t.xr,a=t.yt,l=t.yb,c=e.lSite,b=e.rSite,f=c.x,u=c.y,d=b.x,p=b.y,v=(f+d)/2,y=(u+p)/2;if(this.cells[c.voronoiId].closeMe=!0,this.cells[b.voronoiId].closeMe=!0,p!==u&&(i=(f-d)/(p-u),o=y-i*v),void 0===i){if(n>v||v>=h)return!1;if(f>d){if(!s||s.y<a)s=this.createVertex(v,a);else if(s.y>=l)return!1;r=this.createVertex(v,l)}else{if(!s||s.y>l)s=this.createVertex(v,l);else if(s.y<a)return!1;r=this.createVertex(v,a)}}else if(-1>i||i>1)if(f>d){if(!s||s.y<a)s=this.createVertex((a-o)/i,a);else if(s.y>=l)return!1;r=this.createVertex((l-o)/i,l)}else{if(!s||s.y>l)s=this.createVertex((l-o)/i,l);else if(s.y<a)return!1;r=this.createVertex((a-o)/i,a)}else if(p>u){if(!s||s.x<n)s=this.createVertex(n,i*n+o);else if(s.x>=h)return!1;r=this.createVertex(h,i*h+o)}else{if(!s||s.x>h)s=this.createVertex(h,i*h+o);else if(s.x<n)return!1;r=this.createVertex(n,i*n+o)}return e.va=s,e.vb=r,!0},Voronoi.prototype.clipEdge=function(e,t){var r=e.va.x,i=e.va.y,o=e.vb.x,s=e.vb.y,n=0,h=1,a=o-r,l=s-i,c=r-t.xl;if(0===a&&0>c)return!1;var b=-c/a;if(0>a){if(n>b)return!1;h>b&&(h=b)}else if(a>0){if(b>h)return!1;b>n&&(n=b)}if(c=t.xr-r,0===a&&0>c)return!1;if(b=c/a,0>a){if(b>h)return!1;b>n&&(n=b)}else if(a>0){if(n>b)return!1;h>b&&(h=b)}if(c=i-t.yt,0===l&&0>c)return!1;if(b=-c/l,0>l){if(n>b)return!1;h>b&&(h=b)}else if(l>0){if(b>h)return!1;b>n&&(n=b)}if(c=t.yb-i,0===l&&0>c)return!1;if(b=c/l,0>l){if(b>h)return!1;b>n&&(n=b)}else if(l>0){if(n>b)return!1;h>b&&(h=b)}return n>0&&(e.va=this.createVertex(r+n*a,i+n*l)),1>h&&(e.vb=this.createVertex(r+h*a,i+h*l)),(n>0||1>h)&&(this.cells[e.lSite.voronoiId].closeMe=!0,this.cells[e.rSite.voronoiId].closeMe=!0),!0},Voronoi.prototype.clipEdges=function(e){for(var t,r=this.edges,i=r.length,o=Math.abs;i--;)t=r[i],(!this.connectEdge(t,e)||!this.clipEdge(t,e)||o(t.va.x-t.vb.x)<1e-9&&o(t.va.y-t.vb.y)<1e-9)&&(t.va=t.vb=null,r.splice(i,1))},Voronoi.prototype.closeCells=function(e){for(var t,r,i,o,s,n,h,a,l,c=e.xl,b=e.xr,f=e.yt,u=e.yb,d=this.cells,p=d.length,v=Math.abs;p--;)if(t=d[p],t.prepareHalfedges()&&t.closeMe){for(i=t.halfedges,o=i.length,r=0;o>r;){if(n=i[r].getEndpoint(),a=i[(r+1)%o].getStartpoint(),v(n.x-a.x)>=1e-9||v(n.y-a.y)>=1e-9)switch(!0){case this.equalWithEpsilon(n.x,c)&&this.lessThanWithEpsilon(n.y,u):if(l=this.equalWithEpsilon(a.x,c),h=this.createVertex(c,l?a.y:u),s=this.createBorderEdge(t.site,n,h),r++,i.splice(r,0,this.createHalfedge(s,t.site,null)),o++,l)break;n=h;case this.equalWithEpsilon(n.y,u)&&this.lessThanWithEpsilon(n.x,b):if(l=this.equalWithEpsilon(a.y,u),h=this.createVertex(l?a.x:b,u),s=this.createBorderEdge(t.site,n,h),r++,i.splice(r,0,this.createHalfedge(s,t.site,null)),o++,l)break;n=h;case this.equalWithEpsilon(n.x,b)&&this.greaterThanWithEpsilon(n.y,f):if(l=this.equalWithEpsilon(a.x,b),h=this.createVertex(b,l?a.y:f),s=this.createBorderEdge(t.site,n,h),r++,i.splice(r,0,this.createHalfedge(s,t.site,null)),o++,l)break;n=h;case this.equalWithEpsilon(n.y,f)&&this.greaterThanWithEpsilon(n.x,c):if(l=this.equalWithEpsilon(a.y,f),h=this.createVertex(l?a.x:c,f),s=this.createBorderEdge(t.site,n,h),r++,i.splice(r,0,this.createHalfedge(s,t.site,null)),o++,l)break;if(n=h,l=this.equalWithEpsilon(a.x,c),h=this.createVertex(c,l?a.y:u),s=this.createBorderEdge(t.site,n,h),r++,i.splice(r,0,this.createHalfedge(s,t.site,null)),o++,l)break;if(n=h,l=this.equalWithEpsilon(a.y,u),h=this.createVertex(l?a.x:b,u),s=this.createBorderEdge(t.site,n,h),r++,i.splice(r,0,this.createHalfedge(s,t.site,null)),o++,l)break;if(n=h,l=this.equalWithEpsilon(a.x,b),h=this.createVertex(b,l?a.y:f),s=this.createBorderEdge(t.site,n,h),r++,i.splice(r,0,this.createHalfedge(s,t.site,null)),o++,l)break;default:throw"Voronoi.closeCells() > this makes no sense!"}r++}t.closeMe=!1}},Voronoi.prototype.quantizeSites=function(e){for(var t,r=this.ε,i=e.length;i--;)t=e[i],t.x=Math.floor(t.x/r)*r,t.y=Math.floor(t.y/r)*r},Voronoi.prototype.recycle=function(e){if(e){if(!(e instanceof this.Diagram))throw"Voronoi.recycleDiagram() > Need a Diagram object.";this.toRecycle=e}},Voronoi.prototype.compute=function(e,t){var r=new Date;this.reset(),this.toRecycle&&(this.vertexJunkyard=this.vertexJunkyard.concat(this.toRecycle.vertices),this.edgeJunkyard=this.edgeJunkyard.concat(this.toRecycle.edges),this.cellJunkyard=this.cellJunkyard.concat(this.toRecycle.cells),this.toRecycle=null);var i=e.slice(0);i.sort(function(e,t){var r=t.y-e.y;return r?r:t.x-e.x});for(var o,s,n,h=i.pop(),a=0,l=this.cells;;)if(n=this.firstCircleEvent,h&&(!n||h.y<n.y||h.y===n.y&&h.x<n.x))(h.x!==o||h.y!==s)&&(l[a]=this.createCell(h),h.voronoiId=a++,this.addBeachsection(h),s=h.y,o=h.x),h=i.pop();else{if(!n)break;this.removeBeachsection(n.arc)}this.clipEdges(t),this.closeCells(t);var c=new Date,b=new this.Diagram;return b.cells=this.cells,b.edges=this.edges,b.vertices=this.vertices,b.execTime=c.getTime()-r.getTime(),this.reset(),b},"undefined"!=typeof module&&(module.exports=Voronoi);
},{}]},{},[2])(2)
});